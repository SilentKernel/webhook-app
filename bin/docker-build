#!/usr/bin/env bash
set -euo pipefail

REGISTRY="registry.developpeur-freelance.io"
IMAGE_NAME="silent/hoostack"
COMMIT_SHA="$(git rev-parse --short HEAD)"
FULL_IMAGE="${REGISTRY}/${IMAGE_NAME}:${COMMIT_SHA}"

echo ""
echo "  Image:  ${FULL_IMAGE}"
echo "  Commit: $(git log -1 --format='%h %s')"
echo ""

echo "==> Building..."
docker build --platform linux/amd64 -t "$FULL_IMAGE" .

echo "==> Pushing..."
docker push "$FULL_IMAGE"

echo ""
echo "==> Done. Tag to deploy: ${COMMIT_SHA}"
echo ""
